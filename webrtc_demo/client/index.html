<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>WebRTC Receiver</title>
</head>
<body>
  <h2>受信中映像:</h2>
  <video id="video" autoplay playsinline controls></video>

  <script>
    const pc = new RTCPeerConnection({
      iceServers: [{ urls: "stun:stun.l.google.com:19302" }]
    });

    const ws = new WebSocket("ws://localhost:8080/ws"); // signaling-server の URL

    pc.onicecandidate = ({ candidate }) => {
      if (candidate) {
        ws.send(JSON.stringify(candidate));
      }
    };

    ws.onopen = async () => {
      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
      ws.send(JSON.stringify(offer));
    };

    ws.onmessage = async (event) => {
      const msg = JSON.parse(event.data);
      if (msg.type === "answer") {
        await pc.setRemoteDescription(msg);
      } else if (msg.candidate) {
        await pc.addIceCandidate(msg);
      }
    };

    pc.ontrack = (event) => {
      document.getElementById("video").srcObject = event.streams[0];
    };
  </script>
</body>
</html>
